generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Admin {
  id           String   @id @default(uuid()) @db.Uuid
  email        String   @unique @db.VarChar(255)
  passwordHash String   @map("password_hash") @db.VarChar(255)
  username     String   @db.VarChar(100)
  isActive     Boolean  @default(true) @map("is_active")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  @@index([email])
  @@map("admins")
}

model BusinessLogin {
  id                String                     @id @default(uuid()) @db.Uuid
  email             String                     @unique @db.VarChar(255)
  passwordHash      String                     @map("password_hash") @db.VarChar(255)
  isActive          Boolean                    @default(true) @map("is_active")
  createdAt         DateTime                   @default(now()) @map("created_at")
  updatedAt         DateTime                   @updatedAt @map("updated_at")
  onboardingRequest BusinessOnboardingRequest? @relation("BusinessLoginOnboardingRequest")
  business          Business?

  @@index([email])
  @@map("business_logins")
}

model Category {
  id          Int        @id @default(autoincrement())
  name        String     @unique @db.VarChar(100)
  slug        String     @unique @db.VarChar(100)
  description String?
  createdAt   DateTime   @default(now()) @map("created_at")
  businesses  Business[]

  @@map("categories")
}

model Business {
  id                       String                   @id @default(uuid()) @db.Uuid
  businessLoginId          String                   @unique @map("business_login_id") @db.Uuid
  name                     String                   @db.VarChar(100)
  registrationNumber       String                   @unique @map("registration_number") @db.VarChar(100)
  categoryId               Int                      @map("category_id")
  businessType             String                   @map("business_type") @db.VarChar(100)
  yearEstablished          Int                      @map("year_established")
  location                 String                   @db.VarChar(100)
  teamSize                 String                   @map("team_size") @db.VarChar(50)
  paidUpCapital            String?                  @map("paid_up_capital") @db.VarChar(100)
  minimumInvestmentUnits   Int?                     @map("minimum_investment_units")
  maximumInvestmentUnits   Int?                     @map("maximum_investment_units")
  pricePerUnit             Decimal?                 @map("price_per_unit") @db.Decimal(15, 2)
  expectedReturnOptions    String?                  @map("expected_return_options") @db.VarChar(255)
  estimatedMarketValuation Decimal?                 @map("estimated_market_valuation") @db.Decimal(15, 2)
  ipoTimeHorizon           String?                  @map("ipo_time_horizon") @db.VarChar(100)
  briefDescription         String                   @map("brief_description") @db.VarChar(2000)
  fullDescription          String?                  @map("full_description")
  vision                   String?
  mission                  String?
  growthPlans              String?                  @map("growth_plans")
  contactEmail             String                   @map("contact_email") @db.VarChar(255)
  contactPhone             String                   @map("contact_phone") @db.VarChar(20)
  website                  String?                  @db.VarChar(255)
  facebookUrl              String?                  @map("facebook_url") @db.VarChar(255)
  linkedinUrl              String?                  @map("linkedin_url") @db.VarChar(255)
  logoUrl                  String?                  @map("logo_url") @db.VarChar(500)
  status                   BusinessStatus           @default(PENDING)
  rejectionReason          String?                  @map("rejection_reason")
  isActive                 Boolean                  @default(true) @map("is_active")
  viewCount                Int                      @default(0) @map("view_count")
  isFeatured               Boolean                  @default(false) @map("is_featured")
  createdAt                DateTime                 @default(now()) @map("created_at")
  updatedAt                DateTime                 @updatedAt @map("updated_at")
  promoterProfile          String?                  @map("promoter_profile")
  address                  String?                  @db.VarChar(255)
  fundingStage             String?                  @map("funding_stage") @db.VarChar(100)
  panNumber                String?                  @map("pan_number") @db.VarChar(50)
  instagramUrl             String?                  @map("instagram_url") @db.VarChar(255)
  media                    BusinessMedia[]
  removalRequests          BusinessRemovalRequest[]
  businessLogin            BusinessLogin            @relation(fields: [businessLoginId], references: [id], onDelete: Cascade)
  category                 Category                 @relation(fields: [categoryId], references: [id])
  interests                InterestSubmission[]

  @@index([businessLoginId])
  @@index([categoryId])
  @@index([status])
  @@index([location])
  @@index([isFeatured])
  @@index([createdAt(sort: Desc)])
  @@map("businesses")
}

model BusinessMedia {
  id              String              @id @default(uuid()) @db.Uuid
  businessId      String              @map("business_id") @db.Uuid
  mediaType       MediaType           @map("media_type")
  fileName        String?             @map("file_name") @db.VarChar(255)
  fileUrl         String?             @map("file_url") @db.VarChar(500)
  fileSize        BigInt?             @map("file_size")
  mimeType        String?             @map("mime_type") @db.VarChar(100)
  externalUrl     String?             @map("external_url") @db.VarChar(500)
  title           String?             @db.VarChar(200)
  description     String?
  displayOrder    Int                 @default(0) @map("display_order")
  approvalStatus  MediaApprovalStatus @default(PENDING) @map("approval_status")
  rejectionReason String?             @map("rejection_reason")
  uploadedAt      DateTime            @default(now()) @map("uploaded_at")
  approvedAt      DateTime?           @map("approved_at")
  business        Business            @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([mediaType])
  @@index([approvalStatus])
  @@map("business_media")
}

model LeadSource {
  id         String               @id @default(uuid()) @db.Uuid
  businessId String               @map("business_id") @db.Uuid
  name       String               @db.VarChar(100)
  isDefault  Boolean              @default(false) @map("is_default")
  createdAt  DateTime             @default(now()) @map("created_at")
  interests  InterestSubmission[]

  @@unique([businessId, name])
  @@index([businessId])
  @@map("lead_sources")
}

model InterestSubmission {
  id              String             @id @default(uuid()) @db.Uuid
  businessId      String             @map("business_id") @db.Uuid
  investorName    String             @map("investor_name") @db.VarChar(100)
  phoneNumber     String             @map("phone_number") @db.VarChar(20)
  email           String             @db.VarChar(255)
  message         String?
  hasConsent      Boolean            @default(true) @map("has_consent")
  submittedAt     DateTime           @default(now()) @map("submitted_at")
  contacted       Boolean            @default(false)
  followUpRemarks String?            @map("follow_up_remarks")
  source          String             @default("aarthiQ Platform") @db.VarChar(100)
  sourceId        String?            @map("source_id") @db.Uuid
  status          InterestStatus     @default(NOT_CONTACTED)
  followUps       InterestFollowUp[]
  business        Business           @relation(fields: [businessId], references: [id], onDelete: Cascade)
  leadSource      LeadSource?        @relation(fields: [sourceId], references: [id])

  @@index([businessId])
  @@index([email])
  @@index([status])
  @@index([submittedAt(sort: Desc)])
  @@map("interest_submissions")
}

model InterestFollowUp {
  id                   String             @id @default(uuid()) @db.Uuid
  interestSubmissionId String             @map("interest_submission_id") @db.Uuid
  followUpNumber       Int                @map("follow_up_number")
  remarks              String
  createdAt            DateTime           @default(now()) @map("created_at")
  nextFollowUpDate     DateTime?          @map("next_follow_up_date") @db.Date
  interestSubmission   InterestSubmission @relation(fields: [interestSubmissionId], references: [id], onDelete: Cascade)

  @@index([interestSubmissionId])
  @@index([followUpNumber])
  @@index([nextFollowUpDate])
  @@map("interest_follow_ups")
}

model BusinessOnboardingRequest {
  id                     String           @id @default(uuid()) @db.Uuid
  businessName           String           @map("business_name") @db.VarChar(255)
  email                  String           @db.VarChar(255)
  phoneNumber            String           @map("phone_number") @db.VarChar(20)
  message                String?
  status                 OnboardingStatus @default(PENDING)
  rejectionReason        String?          @map("rejection_reason")
  onboardingToken        String?          @unique @map("onboarding_token") @db.VarChar(255)
  tokenExpiresAt         DateTime?        @map("token_expires_at")
  submittedAt            DateTime         @default(now()) @map("submitted_at")
  reviewedAt             DateTime?        @map("reviewed_at")
  createdBusinessLoginId String?          @unique @map("created_business_login_id") @db.Uuid
  createdBusinessLogin   BusinessLogin?   @relation("BusinessLoginOnboardingRequest", fields: [createdBusinessLoginId], references: [id])

  @@index([email])
  @@index([status])
  @@index([submittedAt(sort: Desc)])
  @@map("business_onboarding_requests")
}

model BusinessRemovalRequest {
  id          String    @id @default(uuid()) @db.Uuid
  businessId  String    @map("business_id") @db.Uuid
  reason      String?
  status      String    @default("PENDING") @db.VarChar(50)
  requestedAt DateTime  @default(now()) @map("requested_at")
  reviewedAt  DateTime? @map("reviewed_at")
  reviewedBy  String?   @map("reviewed_by") @db.Uuid
  business    Business  @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@index([businessId])
  @@index([status])
  @@index([requestedAt(sort: Desc)])
  @@map("business_removal_requests")
}

enum BusinessStatus {
  PENDING
  APPROVED
  REJECTED
}

enum MediaType {
  REGISTRATION_CERTIFICATE
  PAN_CERTIFICATE
  FINANCIAL_DOCUMENT
  PITCH_DECK
  BROCHURE
  DOCUMENT
  COMPANY_LOGO
  GALLERY
  IMAGE
  VIDEO
  YOUTUBE_VIDEO
  WEBSITE
}

enum MediaApprovalStatus {
  PENDING
  APPROVED
  REJECTED
}

enum OnboardingStatus {
  PENDING
  CONTACTED
  APPROVED
  REJECTED
}

enum InterestStatus {
  NOT_CONTACTED
  INTERESTED
  NOT_INTERESTED
}
